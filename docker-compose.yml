version: '3'

services:
  h2db:
    image: oscarfonts/h2
    volumes:
      - /opt/data:/opt/h2data
    ports:
      - 1521:1521
      - 81:81
    networks:
      - demonet
    hostname: h2db
    environment:
      H2_OPTIONS: '-ifNotExists'

  repo:
    build: ./demo-repo-service
    volumes:
      - ./demo-repo-service/deploy:/usr/local/opt/repo-service
    ports:
      - 7082:7082
      - 8445:8445
    networks:
      - demonet
    hostname: repo
    depends_on:
      - h2db

  todo:
    build: ./demo-todo-service
    volumes:
      - ./demo-todo-service/deploy:/usr/local/opt/todo-service
    ports:
      - 7079:7079
    networks:
      - demonet
    hostname: todo
    depends_on:
      - repo
    links:
      - repo

  rest:
    build: ./demo-rest-service
    volumes:
      - ./demo-rest-service/deploy:/usr/local/opt/rest-service
    ports:
      - 7080:7080
      - 8443:8443
    networks:
      - demonet
    hostname: rest
    depends_on:
      - todo
    links:
      - todo

networks:
  demonet:
    driver: bridge
